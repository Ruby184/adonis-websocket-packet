!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):((e="undefined"!=typeof globalThis?globalThis:e||self).adonis=e.adonis||{},e.adonis.wsp=t())}(this,function(){"use strict";var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e};function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},b=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(n=(a=c.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{!n&&c.return&&c.return()}finally{if(o)throw i}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,Error),e(i,null,[{key:"_prepareSuperMessage",value:function(t){try{return JSON.stringify(t)}catch(e){return String(t)}}}]),i);function i(e){t(this,i);e=r(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,i._prepareSuperMessage(e)));return Object.defineProperty(e,"name",{value:"NonError",configurable:!0,writable:!0}),Error.captureStackTrace&&Error.captureStackTrace(e,i),e}function v(t){var e=t.from,r=t.seen,n=t.to_,o=t.forceEnumerable,i=n||(Array.isArray(e)?[]:{});r.push(e);var a=!0,t=!1,n=void 0;try{for(var c=Object.entries(e)[Symbol.iterator]();!(a=(f=c.next()).done);a=!0){var u=f.value,f=b(u,2),u=f[0],f=f[1];"function"!=typeof f&&(f&&"object"===(void 0===f?"undefined":d(f))?r.includes(e[u])?i[u]="[Circular]":i[u]=v({from:e[u],seen:r.slice(),forceEnumerable:o}):i[u]=f)}}catch(e){t=!0,n=e}finally{try{!a&&c.return&&c.return()}finally{if(t)throw n}}var s=!0,t=!1,n=void 0;try{for(var l=E[Symbol.iterator]();!(s=(y=l.next()).done);s=!0){var p=y.value,y=p.property,p=p.enumerable;"string"==typeof e[y]&&Object.defineProperty(i,y,{value:e[y],enumerable:!!o||p,configurable:!0,writable:!0})}}catch(e){t=!0,n=e}finally{try{!s&&l.return&&l.return()}finally{if(t)throw n}}return i}var E=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0}],a=function(e){return"object"===(void 0===e?"undefined":d(e))&&null!==e?v({from:e,seen:[],forceEnumerable:!0}):"function"==typeof e?"[Function: "+(e.name||"anonymous")+"]":e},c={OPEN:0,JOIN:1,LEAVE:2,JOIN_ACK:3,JOIN_ERROR:4,LEAVE_ACK:5,LEAVE_ERROR:6,EVENT:7,PING:8,PONG:9,ACK:10,ACK_ERROR:11};function u(e,t,r,n){n=3<arguments.length&&void 0!==n?n:[];return r.forEach(function(e){!function(e,t){if(!e||"string"!=typeof e)throw new Error(t)}(t[e],"expected "+e+" to be a valid string")}),n.forEach(function(e){void 0===t[e]&&delete t[e]}),{t:e,d:t}}var f={deserializeError:function(e){if(e instanceof Error)return e;if("object"!==(void 0===e?"undefined":d(e))||null===e||Array.isArray(e))return new o(e);var t=new Error;return v({from:e,seen:[],to_:t}),t}};return Object.keys(c).forEach(function(t){var e=t.toLowerCase().replace(/^\w|_(\w)/g,function(e,t){return(t||e).toUpperCase()});f["is"+e+"Packet"]=function(e){return!(!e||"object"!==(void 0===e?"undefined":d(e))||e.t!==c[t])}}),f.hasTopic=function(e){return!!(e&&e.d&&e.d.topic)},f.isValidJoinPacket=f.hasTopic,f.isValidLeavePacket=f.hasTopic,f.isValidEventPacket=f.hasTopic,f.isValidAckPacket=f.hasTopic,f.isValidAckErrorPacket=f.hasTopic,f.joinPacket=function(e){return u(c.JOIN,{topic:e},["topic"])},f.leavePacket=function(e){return u(c.LEAVE,{topic:e},["topic"])},f.joinAckPacket=function(e){return u(c.JOIN_ACK,{topic:e},["topic"])},f.joinErrorPacket=function(e,t){return u(c.JOIN_ERROR,{topic:e,message:t},["topic","message"])},f.leaveAckPacket=function(e){return u(c.LEAVE_ACK,{topic:e},["topic"])},f.leaveErrorPacket=function(e,t){return u(c.LEAVE_ERROR,{topic:e,message:t},["topic","message"])},f.eventPacket=function(e,t){return u(c.EVENT,{topic:e,event:t,data:2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",id:arguments[3]},["topic","event"],["id"])},f.pingPacket=function(){return{t:c.PING}},f.pongPacket=function(){return{t:c.PONG}},f.ackPacket=function(e,t){return u(c.ACK,{topic:e,id:t,data:2<arguments.length&&void 0!==arguments[2]?arguments[2]:""},["topic"])},f.ackErrorPacket=function(e,t,r){var n=process.env.NODE_ENV&&/dev/i.test(process.env.NODE_ENV);return u(c.ACK_ERROR,Object.assign(a(r),{topic:e,id:t,stack:n?r.stack:void 0}),["topic","message"],["name","code","stack"])},Object.assign({codes:c},f)});
